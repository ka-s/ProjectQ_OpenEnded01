MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ; ================================================================
                      00002 ;  ProjectQ Computer Interaction Design Class
                      00003 ;  PIC16LF88-I/P Sample Code
                      00004 ;
                      00005 ;  Apr. 2, 2014
                      00006 ;  Original codes & words by S.C.Matsushita
                      00007 ; ================================================================
                      00008         list    p=16f88
                      00009         include <p16f88.inc>
                      00001         LIST
                      00002 ; P16F88.INC  Standard Header File, Version 1.00    Microchip Technology, Inc.
                      00410         LIST
2007   3F10           00010         __config        0x2007, 0x3f10
                      00011 ;
                      00012 ; コンフィグレーションレジスタ（＃１）　メモリアドレス0x2007
                      00013 ; コード保護機能オフ、RB6/RB7/RA5/RA6/RA7を一般I/O端子として使用
                      00014 ; 電源電圧低下リセット機能無効、電源ON時リセットタイミング発生機能有効、
                      00015 ; WDT（ウォッチドッグタイマー）無効、PIC16F88内蔵RC発振器をクロックとして使用
                      00016 ;
2008   3FFC           00017         __config        0x2008, 0x3ffc
                      00018 ;
                      00019 ; コンフィグレーションレジスタ（＃２）　メモリアドレス0x2008
                      00020 ; 緊急用クロック信号源切り替えシステム無効
                      00021 ; 
                      00022 ; memory address
                      00023 ; 0x20 - 0x6f データメモリ（自由利用可：バンク０）
                      00024 ; 0x70 - 0x7f データメモリ（全バンクよりアクセス可）
                      00025 ;
                      00026 ; メモリバンク（PIC16F88では0,1,2,3の４バンク有）
                      00027 ; ファイルレジスタSTATUSのRP0ビット及びRP1ビットでバンク切り替えを設定
                      00028 ; RP0 = 0, RP1 = 0 -> バンク０を選択　（デフォルト）
                      00029 ; RP0 = 1, RP1 = 0 -> バンク１を選択　（特殊機能レジスタを使う場合等に設定）
                      00030 ; 通常のプログラム動作ではバンク０を選択し、必要な時だけ他のバンクに切り替える
                      00031 ;　また、バンク１〜３に切り替えた場合は、必要な処理が終了した後に必ずバンク０に戻す
                      00032 ;
                      00033 ;
                      00034 ; 割り込みプログラム用データメモリ
                      00035 ;
  00000070            00036 WSAVE           equ     0x70            ; Wレジスタ保存用メモリ
  00000071            00037 STATSAVE        equ     0x71            ; STATUSレジスタ保存用メモリ
  00000072            00038 PCLATHSAVE      equ     0x72            ; プログラムカウンタ上位ビット保存用メモリ
  00000073            00039 FSRSAVE         equ     0x73            ; 配列メモリアクセス用レジスタ保存用メモリ
  00000074            00040 IntFlag         equ     0x74            ; 割り込みが生じたことを記録するレジスタ
                      00041 ;
                      00042 ; A/Dコンバータ用データメモリ
                      00043 ;
  00000075            00044 AD_Timer        equ     0x75 ; A/D変換用ワークエリア
  00000076            00045 AD_temp         equ     0x76 ; A/D変換用ワークエリア
  00000077            00046 ADL                     equ     0x77 ;　A/D変換結果・下位２ビット（左詰め）
  00000078            00047 ADH                     equ     0x78 ; A/D変換結果・上位８ビット
                      00048 ;
                      00049 ; A/D変換の有効精度は１０ビットなので、８ビットのレジスタ２つ（ADH:ADL）を使う際には
                      00050 ; 6ビット分が空白になる。ここでは「左詰め：left-justified」とすることで、ADHに
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00051 ;　上位８ビット分を、ADLには下位２ビット分を格納し、ADLのLSBから６ビット分の範囲には
                      00052 ; ゼロが書き込まれる仕様となっている。
                      00053 ;
                      00054 ; ソフトウエアタイマー用ワークエリア
                      00055 ;
  00000079            00056 Var1            equ     0x79
  0000007A            00057 Var2            equ 0x7a
  0000007B            00058 Var3            equ     0x7b
                      00059 ;
                      00060 ; ハードウエアシリアル通信ポート用ワークエリア
                      00061 ;
  0000007C            00062 RXBuf           equ     0x7c
  0000007D            00063 TXBuf           equ 0x7d
                      00064 ;
                      00065 ; ハードウエアシリアル通信ポート用通信速度設定値
                      00066 ;
  00000019            00067 Baud_096        equ D'25'               ; 9600ビット毎秒（bps）にする際の設定値
  0000000C            00068 Baud_192        equ     D'12'           ; 19200bpsにする際の設定値
                      00069 ;
                      00070 ; 自由利用可・データメモリ（x0 〜　x9）
                      00071 ;
  00000020            00072 x0                      equ 0x20
  00000021            00073 x1                      equ 0x21
  00000022            00074 x2                      equ 0x22
  00000023            00075 x3                      equ 0x23
  00000024            00076 x4                      equ 0x24
  00000025            00077 x5                      equ 0x25
  00000026            00078 x6                      equ     0x26
  00000027            00079 x7                      equ 0x27
  00000028            00080 x8                      equ 0x28
  00000029            00081 x9                      equ 0x29
                      00082 ;
                      00083 ;必要であれば、この先0x2a〜0x6fの範囲で、適当に変数を宣言しても良い
                      00084 ;
                      00085 ; 配列型データを扱うためのデータメモリ領域
  00000050            00086 array           equ 0x50        ; 配列の開始アドレスを宣言している
                      00087 ; 0x6fまでメモリを使用できるので、0x50-0x6fの32バイトが配列データとして使用できる
                      00088 
0000                  00089         org     0x00                    ; 電源ON（リセット）では、ここから処理が始まる
0000                  00090 Reset
                      00091 ;       call    arraytest       ; 配列データアクセスのサンプルコードへ
0000   281E           00092         goto    Start           ; 通常プログラムの先頭へ飛ぶ
                      00093 
0004                  00094         org     0x04                    ; 割り込みが発生すると、ここから処理が始まる
0004                  00095 interrupt
0004   00F0           00096         movwf   WSAVE           ; Wレジスタを最初に保存する
0005   0E03           00097         swapf   STATUS, 0       ; STATUSレジスタの値がWレジスタに入る
0006   0183           00098         clrf    STATUS          ; データメモリバンクを０にセットする
0007   00F1           00099         movwf   STATSAVE        ; 割り込み直前のSTATUSレジスタの値を保存する
0008   080A           00100         movf    PCLATH, 0       ; プログラムカウンタの上位ビット（８ビット）をWレジスタに転送
0009   00F2           00101         movwf   PCLATHSAVE      ; プログラムカウンタの上位ビットを保存する
000A   018A           00102         clrf    PCLATH          ; 割り込みプログラムはメモリの最上位付近に必ず置かれている
000B   0804           00103         movf    FSR, 0          ; 配列データアクセス用ポインタの値をWレジスタに入れる
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000C   00F3           00104         movwf   FSRSAVE         ; FSRポインタの値を保存する
                      00105 
000D   190C           00106         btfsc   PIR1, CCP1IF    ; 割り込み原因がCCP1（タイマが設定値に到達）であるかチェック
000E   2810           00107         goto    TMR1interrupt   ; CCP1が原因で割り込みが発生した
                      00108 
                      00109 ; CCP1IFではない原因で割り込みが起きた場合に処理されるプログラムをここに書く
                      00110 ; 例えば、INTF(RB0/INT割り込み)が原因として特定できるのであれば、
                      00111 ;       bcf             INTCON, INTF
                      00112 ; として、INTFをクリアする：クリアしないと永遠に割り込み続ける
                      00113 
000F   2815           00114         goto    intend          ; 割り込みプログラムから通常プログラムへの復帰処理を行う
                      00115 
0010                  00116 TMR1interrupt
0010   110C           00117         bcf             PIR1, CCP1IF    ; CCP1IF　タイマ割り込みフラグを０にする
                      00118 
0011   3002           00119         movlw   B'00000010'     ; ビット１だけが１になっているデータ
0012   0686           00120         xorwf   PORTB, 1        ; RB1の値が1/0反転する -> LEDの点灯／消灯が逆転する
                      00121 
0013   30FF           00122         movlw   0xff
0014   00F4           00123         movwf   IntFlag         ; 変数IntFlagに0xffを代入し、割り込み発生を伝える
                      00124 
0015                  00125 intend                                  ; 保存しておいた割り込み直前のレジスタの値を元に戻す
0015   0873           00126         movf    FSRSAVE, 0
0016   0084           00127         movwf   FSR                     ; FSRレジスタを復帰
0017   0872           00128         movf    PCLATHSAVE, 0
0018   008A           00129         movwf   PCLATH          ; PCLATHレジスタを復帰
0019   0E71           00130         swapf   STATSAVE, 0
001A   0083           00131         movwf   STATUS          ; STATUSレジスタを復帰
001B   0EF0           00132         swapf   WSAVE, 1
001C   0E70           00133         swapf   WSAVE, 0        ; Wレジスタを復帰
001D   0009           00134         retfie                          ; retfieで、割り込みが発生した時点のプログラム実行位置に戻る
                      00135 ;
                      00136 ; --------------------------------
                      00137 ;  通常プログラム
                      00138 ; --------------------------------
001E                  00139 Start
                      00140 ;
001E   1683           00141         bsf     STATUS, RP0             ; データメモリバンク１番を選択
                      00142 ;
                      00143 ;               TRISA, TRISB 信号方向設定               0 -> 出力       1 ->　入力
                      00144 ;
                      00145 ; PORTA 入出力方向設定
                      00146 ;
001F   30BC           00147         movlw   B'10111100'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0020   0085           00148         movwf   TRISA           
                      00149                                         ; RA0 for 出力 (未使用)
                      00150                                         ; RA1 for 出力 (未使用)
                      00151                                         ; RA2 for 入力 (A/Dコンバータ 加速度Z軸)
                      00152                                         ; RA3 for　入力 (A/Dコンバータ　加速度ｙ軸)
                      00153                                         ; RA4 for 入力 (A/Dコンバータ　加速度ｘ軸)
                      00154                                         ; RA5 for 入力（専用） (未使用)
                      00155                                         ; RA6 for 出力（専用）　(未使用)
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00156                                         ; RA7 for 入力(専用)　(未使用)
                      00157 
                      00158 ;RA5, RA6, RA7の入出力方向は、初期設定値から変更できない
                      00159 
                      00160 ;
                      00161 ; PORTB 入出力方向設定
                      00162 ;
0021   3001           00163         movlw   B'00000001'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0022   0086           00164         movwf   TRISB
                      00165                                         ; RB0 for 入力 (押しボタンスイッチ)
                      00166                                         ; RB1 for 出力　(LED1)
                      00167                                         ; RB2 for 出力 (LED2)
                      00168                                         ; RB3 for 出力　(LED3)
                      00169                                         ; RB4 for 出力　(LED4)
                      00170                                         ; RB5 for 出力　(未使用)
                      00171                                         ; RB6 for 出力 (未使用)
                      00172                                         ; RB7 for 出力　(未使用)
                      00173 ;
                      00174 ; Option Register　(割り込みピン機能設定等)
                      00175 ;
0023   3087           00176         movlw   B'10000111'     ; RB0/INTピン、1->0変化にてINT割り込みを検出
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0024   0081           00177         movwf   OPTION_REG
                      00178 ; 
                      00179 
0025   1283           00180         bcf             STATUS, RP0     ; データメモリバンク０番を選択
                      00181 ;
                      00182 ; PORTA & PORTB 初期値設定
                      00183 ;
0026   3000           00184         movlw   B'00000000'
0027   0085           00185         movwf   PORTA
0028   3001           00186         movlw   B'00000001'     ; RB0 = 1 (押しボタンスイッチ・オフ）
0029   0086           00187         movwf   PORTB
                      00188 ;
                      00189 ; A/Dコンバータ　初期設定
                      00190 ;
002A   1683           00191         bsf             STATUS, RP0     ; データメモリバンク１番を選択
002B   3000           00192         movlw   B'00000000'     ; データ形式等の設定を行う
                      00193 ;
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002C   009F           00194         movwf   ADCON1          ; ADCON1レジスタに設定値を書き込む
                      00195 
002D   301C           00196         movlw   B'00011100'     ; AN2,AN3,AN4ピンをアナログ入力に設定
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002E   009B           00197         movwf   ANSEL
002F   1283           00198         bcf             STATUS, RP0 ; データメモリバンク０番を選択
                      00199 ;
                      00200 ; PIC16F88内蔵クロック信号発生器の設定
                      00201 ;
0030   1683           00202         bsf             STATUS, RP0     ; データメモリバンク１番を選択
0031   3060           00203         movlw   B'01100000'     ; クロック周波数を4MHzに設定
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0032   008F           00204         movwf   OSCCON
                      00205 ;
                      00206 ; 内蔵クロック信号発生器の周波数微調整
                      00207 ; （時間精度が必要な場合に使用する）
                      00208 ;
                      00209 ;       movlw   B'00xxxxxx'     ; 微調整値を下位６ビットで指定
                      00210 ;                                               ; 000000 = 中心値：デフォルト
                      00211 ;                                               ; 000001 周波数１ステップアップ
                      00212 ;                                               ; 111111 周波数１ステップダウン
                      00213 ;       movwf   OSCTUNE         ; 微調整用ファイルレジスタ
                      00214 ;
                      00215 
0033                  00216 OSCWAIT
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0033   1D0F           00217         btfss   OSCCON, IOFS
0034   2833           00218         goto    OSCWAIT         ; クロック信号発生器が安定するまで待つ
0035   1283           00219         bcf             STATUS, RP0     ; データメモリバンク０番を選択
                      00220 ;
                      00221 ; --------------------------------
                      00222 ;  メイン部分
                      00223 ; --------------------------------
0036                  00224 StartSign
                      00225 ;
                      00226 ; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                      00227 ;  モーションセンサー処理
                      00228 ; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                      00229 ;
                      00230 ; ピッチ回転(X軸)
0036                  00231 AccChkX
0036   3004           00232         movlw   D'4'            ; AN4端子（Ｘ方向加速度）を指定
0037   2088           00233         call    ADconv          ; A/D変換により加速度を１０ビットの数値に変換する
0038   1BF8           00234         btfsc   ADH, 7          ; 変換結果の上位８ビット(ADH）の最上位ビットを調べる
0039   283D           00235         goto    HighAccX        ; 最上位ビットが１ならHighAccXへ飛ぶ
003A                  00236 LowAccX                                 ; 最上位ビットは０だった
003A   1086           00237         bcf             PORTB, 1        ; LEDを消灯する
003B   0000           00238         nop                             ; １マイクロ秒待つ
003C   2840           00239         goto    AccChkY         ; 続いてロール回転を測定
003D                  00240 HighAccX                                ; 最上位ビットは１だった
003D   1486           00241         bsf             PORTB, 1        ; LEDを点灯する
003E   0000           00242         nop                             ; １マイクロ秒待つ
003F   2840           00243         goto    AccChkY         ; 続いてロール回転を測定
                      00244 ;
                      00245 ; ロール回転(Y軸)
0040                  00246 AccChkY
0040   3003           00247         movlw   D'3'
0041   2088           00248         call    ADconv
0042   1BF8           00249         btfsc   ADH, 7
0043   2847           00250         goto    HighAccY
0044                  00251 LowAccY
0044   1106           00252         bcf             PORTB, 2
0045   0000           00253         nop
0046   284A           00254         goto    AccChkZ
0047                  00255 HighAccY
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0047   1506           00256         bsf             PORTB, 2
0048   0000           00257         nop
0049   284A           00258         goto    AccChkZ
                      00259 ;
                      00260 ; ヨー回転(Z軸)
004A                  00261 AccChkZ
004A   3002           00262         movlw   D'2'
004B   2088           00263         call    ADconv
004C   1BF8           00264         btfsc   ADH, 7
004D   2851           00265         goto    HighAccZ
004E                  00266 LowAccZ
004E   1186           00267         bcf             PORTB, 3
004F   0000           00268         nop
0050   2836           00269         goto    AccChkX
0051                  00270 HighAccZ
0051   1586           00271         bsf             PORTB, 3
0052   0000           00272         nop
0053   2836           00273         goto    AccChkX
                      00274 
                      00275 ;
                      00276 ; TMR1 タイマーの初期設定を行う
                      00277 ;
                      00278 ; T1CON コントロールレジスタの構成
                      00279 ; b7 b6 b5 b4 b3 b2 b1 b0 の順
                      00280 ;
                      00281 ; b5-b4 Prescaler select bits 11=1:8, 10=1:4, 01=1:2, 00=1:1
                      00282 ; b5とb4の２ビットでプリスケーラの減速比を決める
                      00283 ; b0 TMR1ON Timer1 On bit (1 ... enables TMR1, 0 ... stops TMR1)
                      00284 ; b0が１になるとタイマー１が起動しカウントが始まる（０だとカウントが止まる）
                      00285 ;
0054   018F           00286         clrf    TMR1H           ; タイマーレジスタの上位８ビットを０にリセット
0055   018E           00287         clrf    TMR1L           ; タイマーレジスタの下位８ビットを０にリセット
0056   3034           00288         movlw   B'00110100'     ; タイマーの初期設定値 (上記レジスタ設定値を参照）
                      00289                                                 ; プリスケーラ（減速器）が1:8（8分周）に設定されている
                      00290 ;       movlw   B'                      ; プリスケーラの設定を1:1に設定するには、この値を用いる
0057   0090           00291         movwf   T1CON
                      00292 ;
                      00293 ; タイマーレジスタの上限値（この値に達するとTMR1H, TMR1Lが０に戻る）を設定する
                      00294 ;
                      00295 ; 0xf424 = 62,500　が設定値だが、プリスケーラが1:8に設定されているため
                      00296 ; 62,500 x 8usec = 500,000usec = 0.5sec が設定時間となる
                      00297 ;
0058   30F4           00298         movlw   0xf4
0059   0096           00299         movwf   CCPR1H          ; TMR1Hと比較する値
005A   3024           00300         movlw   0x24
005B   0095           00301         movwf   CCPR1L          ; TMR1Lと比較する値
                      00302 ;
005C   300B           00303         movlw   B'00001011'     ;　タイマーレジスタの上限値判定機能を有効化する
005D   0097           00304         movwf   CCP1CON
                      00305 ;
                      00306 ;       タイマー割り込みの設定を行う
                      00307 ;
005E   110C           00308         bcf             PIR1, CCP1IF    ;　タイマー割り込みフラグをリセットする
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00309 ;
                      00310 ; RB0/INTピンにて割り込みを使用する場合は、
                      00311 ;       bcf             INTCON, INTF    ; RB0/INT割り込みフラグをリセットする
                      00312 ;       bsf             INTCON, INTE    ; RB0/INT割り込みを許可する
                      00313 ; を追加する
                      00314 
005F   170B           00315         bsf             INTCON, PEIE    ;　PE(Peripheral)割り込みを許可する
                      00316 ;
0060   1683           00317         bsf             STATUS, RP0             ; データメモリバンク１番を選択
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0061   150C           00318         bsf             PIE1, CCP1IE    ; CCP1IE（タイマー上限値到達）割り込みを許可する
0062   1283           00319         bcf             STATUS, RP0             ; データメモリバンク０番を選択
                      00320 
0063   01F4           00321         clrf    IntFlag                 ; 割り込みが起きたことを記録するデータメモリをクリア
0064   178B           00322         bsf             INTCON, GIE             ; 全割り込み機能を有効化する
0065   1410           00323         bsf             T1CON, TMR1ON   ; TMR1カウント開始
                      00324 
                      00325 ;
0066                  00326 WaitLoop
0066   1C74           00327         btfss   IntFlag, 0              ; 割り込みが起きない限り待ち続ける
0067   2866           00328         goto    WaitLoop
                      00329 
0068   01F4           00330         clrf    IntFlag                 ; 割り込みが起きたことを示すデータメモリをクリア
                      00331 
                      00332 ; タイマー割り込みが起きた時に実行すべきプログラムをここに書く
                      00333 
0069   2866           00334         goto    WaitLoop                ; 次の割り込みを待つ
                      00335 
                      00336 ;
                      00337 ; 配列型変数にアクセスする際のサンプルコード
                      00338 ;
006A                  00339 arraytest
                      00340 ;
006A   3050           00341         movlw   array                   ; arrayのアドレス（８ビット）をｗに読み込む
006B   0084           00342         movwf   FSR                             ; FSRレジスタ（Cでいうポインタ）に書き込む
                      00343 
006C   3012           00344         movlw   0x12
006D   0080           00345         movwf   INDF                    ; INDFに書き込むと，FSRで指示されている
                      00346                                                         ; メモリにデータが書き込まれる
006E   0A84           00347         incf    FSR, 1                  ; ポインタを１つ進める
006F   3034           00348         movlw   0x34
0070   0080           00349         movwf   INDF                    ; 今度はarray+1番地に書き込まれる
                      00350 
0071   3050           00351         movlw   array
0072   0084           00352         movwf   FSR                             ; FSRを初期値に戻す
                      00353 
0073   0800           00354         movf    INDF, 0                 ; INDFを読み出すと，FSRで指示されている
                      00355                                                         ; メモリからデータが読み出される
0074   00A0           00356         movwf   x0                              ; データメモリx0（アドレス0x20）に書き出してみる
                      00357 
0075   3051           00358         movlw   array+1                 ; こういうこともできる
0076   0084           00359         movwf   FSR
                      00360 
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0077   0800           00361         movf    INDF, 0
0078   00A1           00362         movwf   x1                              ; データメモリx1(アドレス0x21)に書き出してみる
                      00363 
0079   0000           00364         nop
                      00365 
007A   0008           00366         return
                      00367 ;
                      00368 ; --------------------------------
                      00369 ;　 ここから以降はcall命令によって呼び出すサブルーチン（関数）
                      00370 ; --------------------------------
                      00371 
                      00372 ; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                      00373 ;  Wait1S
                      00374 ;
                      00375 ;  １秒待つ（クロック周波数＝４ＭＨｚのとき）
                      00376 ; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
007B                  00377 Wait1S
007B   3011           00378         movlw   0x11
007C   00F9           00379         movwf   Var1
007D                  00380 TLoop0
007D   3088           00381         movlw   0x88
007E   00FA           00382         movwf   Var2
007F                  00383 TLoop1
007F   308F           00384         movlw   0x8f
0080   00FB           00385         movwf   Var3
0081                  00386 TLoop2
0081   0BFB           00387         decfsz  Var3, 1
0082   2881           00388         goto    TLoop2
0083   0BFA           00389         decfsz  Var2, 1
0084   287F           00390         goto    TLoop1
0085   0BF9           00391         decfsz  Var1, 1
0086   287D           00392         goto    TLoop0
0087   0008           00393         return
                      00394 ;
                      00395 ; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                      00396 ;  ADconv
                      00397 ;
                      00398 ;  A/D変換を行う（１回につき、１つの入力ピンを処理）
                      00399 ;
                      00400 ;  input                ＷレジスタでA/D変換入力ピンの番号（0から7まで）を指定する
                      00401 ;  output       ADH　A/D変換結果の上位８ビット
                      00402 ;                       ADL A/D変換結果の下位２ビット（MSB2ビットに数値が入り、残りは0となる）
                      00403 ; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0088                  00404 ADconv
0088   3907           00405         andlw   B'00000111'     ; 下位３ビット（チャンネル番号）を抽出する
0089   00F6           00406         movwf   AD_temp
008A   1003           00407         bcf             STATUS, C
008B   0DF6           00408         rlf             AD_temp, 1
008C   0DF6           00409         rlf             AD_temp, 1
008D   0D76           00410         rlf             AD_temp, 0
008E   3841           00411         iorlw   B'01000001'     
008F   009F           00412         movwf   ADCON0          ; A/D変換器にチャンネル情報等を伝える
                      00413 
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0090   3005           00414         movlw   D'5'
0091   00F5           00415         movwf   AD_Timer
0092                  00416 ADconv_waitA                    ; 約１５マイクロ秒待ってA/D変換器のコンデンサを充電
0092   0BF5           00417         decfsz  AD_Timer, 1
0093   2892           00418         goto    ADconv_waitA
                      00419 
0094   130C           00420         bcf             PIR1, ADIF
0095   151F           00421         bsf             ADCON0, GO      ; コンデンサにたまった電荷を数値に変換する
0096                  00422 ADconv_waitB
0096   1F0C           00423         btfss   PIR1, ADIF      ; 数値変換の終了を待つ
0097   2896           00424         goto    ADconv_waitB
0098   130C           00425         bcf             PIR1, ADIF
                      00426 
0099   081E           00427         movf    ADRESH, 0       ; 変換結果の上位８ビットをADHに入れる
009A   00F8           00428         movwf   ADH
                      00429 
009B   1683           00430         bsf             STATUS, RP0     ; select bank1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
009C   081E           00431         movf    ADRESL, 0
009D   1283           00432         bcf             STATUS, RP0     ; select bank0
009E   00F7           00433         movwf   ADL                     ; 変換結果の下位８ビット（ただし６ビット分はゼロ）を
                      00434                                                 ; ADLに入れる　：　B'xx000000'が入る
009F   0008           00435         return
                      00436 ;
                      00437 ; SerialEnable
                      00438 ;
                      00439 ; ハードウエアシリアル通信ポートの機能を有効化する
                      00440 ;
                      00441 ; input なし
                      00442 ; output なし
                      00443 ; 使用条件　クロック周波数４ＭＨｚ、TXDピン（RB5ピン）及びRXDピン（RB2ピン）を
                      00444 ; それぞれ送信ピン、受信ピンとして通信回線に接続
                      00445 ;
00A0                  00446 SerialEnable
                      00447 ;
00A0   3090           00448         movlw   B'10010000'
00A1   0098           00449         movwf   RCSTA
                      00450 ;
00A2   1683           00451         bsf             STATUS, RP0     ; データメモリバンク１番を選択
00A3   3024           00452         movlw   B'00100100'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00A4   0098           00453         movwf   TXSTA
00A5   3019           00454         movlw   Baud_096        ; 9600bpsを設定
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00A6   0099           00455         movwf   SPBRG
00A7   1283           00456         bcf             STATUS, RP0     ; データメモリバンクを０番に戻す
                      00457 ;
00A8   0008           00458         return
                      00459 ;
                      00460 ; receive
                      00461 ;
                      00462 ; ハードウエアシリアルポートから受信データを１バイト読み込む
                      00463 ;
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00464 ; input         なし
                      00465 ; output        RXBuf（ファイルレジスタ）に受信データが入る
                      00466 ; データが受信されるまで永遠に待つ仕様となっている点に注意
                      00467 ;
00A9                  00468 receive
00A9   1E8C           00469         btfss   PIR1, RCIF
00AA   28A9           00470         goto    receive         ; データが受信されるまで待つ
                      00471 
00AB   1918           00472         btfsc   RCSTA, FERR ; フレームエラーの検出
00AC   28B2           00473         goto    FrameError
00AD   1898           00474         btfsc   RCSTA, OERR ; オーバーランエラーの検出
00AE   28B5           00475         goto    OverrunError
00AF   081A           00476         movf    RCREG, 0
00B0                  00477 skiperror
00B0   00FC           00478         movwf   RXBuf
00B1   0008           00479         return                          ; RXBufに結果を入れてリターン
00B2                  00480 FrameError
00B2   081A           00481         movf    RCREG, 0        ; エラーフラグをクリアするためのコード
00B3   30AA           00482         movlw   0xaa            ; エラー種別を示すデータ
00B4   28B0           00483         goto    skiperror
00B5                  00484 OverrunError
00B5   1218           00485         bcf             RCSTA, CREN
00B6   1618           00486         bsf             RCSTA, CREN
00B7   30BB           00487         movlw   0xbb            ; エラー種別を示すデータ
00B8   28B0           00488         goto    skiperror
                      00489 ;
                      00490 ; transmit
                      00491 ;
                      00492 ; ハードウエアシリアルポートから１バイト送信する
                      00493 ;
                      00494 ; input         wレジスタの値
                      00495 ; output        nothing
                      00496 ;
00B9                  00497 transmit
00B9   00FD           00498         movwf   TXBuf           ; 一旦wレジスタの値を保存
00BA   1683           00499         bsf             STATUS, RP0 ; データメモリバンク１番を選択
00BB                  00500 transmit_loop
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00BB   1C98           00501         btfss   TXSTA, TRMT ; データ送信準備ＯＫ？
00BC   28BB           00502         goto    transmit_loop   ; 次のデータを送信できる状態になるまで待つ
                      00503 
00BD   1283           00504         bcf             STATUS, RP0 ; データメモリバンクを０番に戻す
00BE   087D           00505         movf    TXBuf, 0        ; 送信データをwレジスタに入れる
00BF   0099           00506         movwf   TXREG           ; この時点でデータ送信が開始される
                      00507                                                 ; データ送信が完了する前にreturnする
00C0   0008           00508         return
                      00509 ;
                      00510         end
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE 11


SYMBOL TABLE
  LABEL                             VALUE 

ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADCS2                             00000006
ADDEN                             00000003
ADFM                              00000007
ADH                               00000078
ADIE                              00000006
ADIF                              00000006
ADL                               00000077
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
AD_Timer                          00000075
AD_temp                           00000076
ADconv                            00000088
ADconv_waitA                      00000092
ADconv_waitB                      00000096
ANS0                              00000000
ANS1                              00000001
ANS2                              00000002
ANS3                              00000003
ANS4                              00000004
ANS5                              00000005
ANS6                              00000006
ANSEL                             0000009B
AccChkX                           00000036
AccChkY                           00000040
AccChkZ                           0000004A
BF                                00000000
BRGH                              00000002
Baud_096                          00000019
Baud_192                          0000000C
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCPR1H                            00000016
CCPR1L                            00000015
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE 12


SYMBOL TABLE
  LABEL                             VALUE 

CIS                               00000003
CKE                               00000006
CKP                               00000004
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000009C
CMIE                              00000006
CMIF                              00000006
CREN                              00000004
CSRC                              00000007
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            0000009D
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
D_A                               00000005
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
F                                 00000001
FERR                              00000002
FREE                              00000004
FSR                               00000004
FSRSAVE                           00000073
FrameError                        000000B2
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
HighAccX                          0000003D
HighAccY                          00000047
HighAccZ                          00000051
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE 13


SYMBOL TABLE
  LABEL                             VALUE 

IOFS                              00000002
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
IntFlag                           00000074
LowAccX                           0000003A
LowAccY                           00000044
LowAccZ                           0000004E
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
OERR                              00000001
OPTION_REG                        00000081
OSCCON                            0000008F
OSCTUNE                           00000090
OSCWAIT                           00000033
OSFIE                             00000007
OSFIF                             00000007
OSTS                              00000003
OverrunError                      000000B5
P                                 00000004
PCL                               00000002
PCLATH                            0000000A
PCLATHSAVE                        00000072
PCON                              0000008E
PEIE                              00000006
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
R                                 00000002
RBIE                              00000003
RBIF                              00000000
RC8_9                             00000006
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE 14


SYMBOL TABLE
  LABEL                             VALUE 

RC9                               00000006
RCD8                              00000000
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
READ_WRITE                        00000002
RP0                               00000005
RP1                               00000006
RX9                               00000006
RX9D                              00000000
RXBuf                             0000007C
R_W                               00000002
Reset                             00000000
S                                 00000003
SCS0                              00000000
SCS1                              00000001
SMP                               00000007
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
STATSAVE                          00000071
STATUS                            00000003
SWDTE                             00000000
SWDTEN                            00000000
SYNC                              00000004
SerialEnable                      000000A0
Start                             0000001E
StartSign                         00000036
T0CS                              00000005
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1RUN                             00000006
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE 15


SYMBOL TABLE
  LABEL                             VALUE 

TLoop0                            0000007D
TLoop1                            0000007F
TLoop2                            00000081
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR1interrupt                     00000010
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISB                             00000086
TRMT                              00000001
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TUN5                              00000005
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXBuf                             0000007D
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UA                                00000001
VCFG0                             00000004
VCFG1                             00000005
Var1                              00000079
Var2                              0000007A
Var3                              0000007B
W                                 00000000
WCOL                              00000007
WDTCON                            00000105
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE 16


SYMBOL TABLE
  LABEL                             VALUE 

WR                                00000001
WREN                              00000002
WRERR                             00000003
WSAVE                             00000070
Wait1S                            0000007B
WaitLoop                          00000066
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_CCP1_RB0                         00003FFF
_CCP1_RB3                         00002FFF
_CONFIG1                          00002007
_CONFIG2                          00002008
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00001FFF
_CP_OFF                           00003FFF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_EXTCLK                           00003FEF
_EXTRC_CLKOUT                     00003FFF
_EXTRC_IO                         00003FFE
_FCMEN_OFF                        00003FFE
_FCMEN_ON                         00003FFF
_HS_OSC                           00003FEE
_IESO_OFF                         00003FFD
_IESO_ON                          00003FFF
_INTRC_CLKOUT                     00003FFD
_INTRC_IO                         00003FFC
_LP_OSC                           00003FEC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_MCLR_OFF                         00003FDF
_MCLR_ON                          00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_PROTECT_2048                 00003BFF
_WRT_PROTECT_256                  00003DFF
_WRT_PROTECT_ALL                  000039FF
_WRT_PROTECT_OFF                  00003FFF
_XT_OSC                           00003FED
__16F88                           00000001
__DEBUG                           1
array                             00000050
arraytest                         0000006A
intend                            00000015
interrupt                         00000004
receive                           000000A9
skiperror                         000000B0
transmit                          000000B9
transmit_loop                     000000BB
MPASM  5.37                    OPENENDED1.ASM   4-11-2015  16:31:00         PAGE 17


SYMBOL TABLE
  LABEL                             VALUE 

x0                                00000020
x1                                00000021
x2                                00000022
x3                                00000023
x4                                00000024
x5                                00000025
x6                                00000026
x7                                00000027
x8                                00000028
x9                                00000029


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : X--------------- ---------------- ---------------- ----------------
2000 : -------XX------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:   190
Program Memory Words Free:  3906


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :    12 reported,     0 suppressed

